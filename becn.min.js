const becn=(e,r,t)=>{const o=new AbortController;e.abortController=o;const i=(e,r,t)=>{becn.setTime=setTimeout(()=>{e.abortController.abort()},e.time?e.time:2500),becn.cancelRequest=(()=>{clearTimeout(becn.setTime),e.abortController.abort()}),r&&(t.cancelRequest=becn.cancelRequest,r.push(t))},n=e=>(e.method||(e.method="get"),e),a=e=>{if(e.query){let t=0;for(var r in e.query)0===t?(e.url=e.url+"?"+r+"="+e.query[r],t+=1):e.url=e.url+"&"+r+"="+e.query[r];return e}},s=e=>(e.format||(e.format="json"),e),c=(e,r)=>r?JSON.stringify(e):e||e,l=(e,r)=>{let t={};if("get"===e.method.toLowerCase()&&r)return console.error("get request Cannot carry the request body");if("get"!==e.method.toLowerCase()&&r?t=new Request(e.url,{method:e.method,signal:e.abortController.signal,body:r,cache:e.cache?e.cache:"default",credentials:e.credentials?e.credentials:"same-origin",integrity:e.integrity?e.integrity:"",keepalive:!!e.keepalive&&e.keepalive,mode:e.mode?e.mode:"cors",redirect:e.redirect?e.redirect:"follow",referrer:e.referrer?e.referrer:"about:client",referrerPolicy:e.referrerPolicy?e.referrerPolicy:""}):("get"!==e.method.toLowerCase()&&!r||"get"===e.method.toLowerCase()&&!r)&&(t=new Request(e.url,{method:e.method,signal:e.abortController.signal,cache:e.cache?e.cache:"default",credentials:e.credentials?e.credentials:"same-origin",integrity:e.integrity?e.integrity:"",keepalive:!!e.keepalive&&e.keepalive,mode:e.mode?e.mode:"cors",redirect:e.redirect?e.redirect:"follow",referrer:e.referrer?e.referrer:"about:client",referrerPolicy:e.referrerPolicy?e.referrerPolicy:""})),e.json&&t.headers.set("Content-Type","application/json"),e.header)if(e.header instanceof Object)for(var o in e.header)t.headers.set(o,e.header[o]);else t.headers instanceof Headers&&(t.headers=e.header);return t},d=e=>{n(e),a(e),s(e);const r=c(e.body,e.json);return l(e,r)},u=(e,r)=>{r.repeatedRequests=(async()=>await becn(e))},m=(e,r,t,o)=>new Promise((i,n)=>{fetch(e).then(async e=>{clearTimeout(becn.setTime),t&&t(e);let a=e.clone();const s=await a[r.format]();let c={};for(var l in a)"body"===l||"headers"!==l&&"ok"!==l&&"redirected"!==l&&"status"!==l&&"statusText"!==l&&"type"!==l&&"url"!==l||(c[l]=a[l]);if(c.body=s,c.response=!0,o&&e.ok&&o.responseSucceed){await u(r,o);const e=c;if(c=null,c=await o.responseSucceed(e),!c)return console.error("Request interceptor need return response");c.ok,i(c)}else if(o&&!e.ok&&o.responseFailure){await u(r,o);const e=c;if(c=null,c=await o.responseFailure(e),!c)return console.error("Request interceptor need return response");c.ok,i(c)}else e.ok?i(c):e.ok||n(c)},e=>{clearTimeout(becn.setTime),console.error(e);let r={describe:e+""};"AbortError: The user aborted a request."===r?(r.describe="cancelRequest",n(r)):"DOMException: The user aborted a request."===r?(r.describe="requestTimeout",n(r)):n(r)})});if(!e.url){const o=async(n,a,s)=>{if(e.baseUrl&&n.url)e.url=e.baseUrl+n.url;else if(!e.baseUrl&&n.url)e.url=n.url;else if(!n.url)return console.error("The URL address is empty");(!e.time&&n.time||e.time&&n.time)&&(e.time=n.time),(!e.method&&n.method||e.method&&n.method)&&(e.method=n.method),(!e.query&&n.query||e.query&&n.query)&&(e.query=n.query),(!e.body&&n.body||e.body&&n.body)&&(e.body=n.body),(!e.json&&n.json||e.json&&n.json)&&(e.json=n.json),(!e.header&&n.header||e.header&&n.header)&&(e.header=n.header),(!e.mode&&n.mode||e.mode&&n.mode)&&(e.mode=n.mode),(!e.cache&&n.cache||e.cache&&n.cache)&&(e.cache=n.cache),(!e.credentiais&&n.credentiais||e.credentiais&&n.credentiais)&&(e.credentiais=n.credentiais),(!e.integrity&&n.integrity||e.integrity&&n.integrity)&&(e.integrity=n.integrity),(!e.keepalive&&n.keepalive||e.keepalive&&n.keepalive)&&(e.keepalive=n.keepalive),(!e.redirect&&n.redirect||e.redirect&&n.redirect)&&(e.redirect=n.redirect),(!e.referrers&&n.referrers||e.referrers&&n.referrers)&&(e.referrers=n.referrers),(!e.format&&n.format||e.format&&n.format)&&(e.format=n.format),(!r&&a||r&&a)&&(r=a),(!t&&s||t&&s)&&(t=s);let c=d(e);if(o.requestInterceptor){for(var l in c)"url"!==l&&"method"!==l&&"cache"!==l&&"credentials"!==l&&"integrity"!==l&&"keepalive"!==l&&"mode"!==l&&"redirect"!==l&&"referrer"!==l&&"referrerPolicy"!==l||(e[l]=c[l]);c=null;const r=e;if(e=null,e=await o.requestInterceptor(r),!e)return console.error("Request interceptor need return request");c=d(e)}return i(e,r,c),m(c,e,t,o)};return o}if(e.url){let o=d(e);return i(e,r,o),m(o,e,t)}};export default becn;